# Discord 机器人

这是一个功能丰富的 Discord 机器人，包含多个管理模块。

## 功能模块

### 🏆 赛事管理系统
- **赛事申请**: 用户可以申请举办比赛
- **审核流程**: 管理员审核赛事申请
- **频道创建**: 自动创建赛事频道
- **作品投稿**: 参赛者投稿作品链接
- **稿件管理**: 主办人管理投稿作品
- **许可论坛**: 限制只能从指定论坛投稿

#### 新增功能 - 作品投稿管理
1. **许可论坛设置**: 管理员可以设置允许投稿的论坛列表
   - 使用 `/设置赛事申请入口` 命令时可以设置许可论坛
   - 使用 `/管理许可论坛` 命令管理论坛列表
   
2. **投稿验证**: 只允许许可论坛内的帖子链接投稿
   - 自动验证投稿链接是否来自许可论坛
   - 支持论坛帖子链接和频道链接
   
3. **稿件管理**: 主办人可以管理所有投稿
   - 点击 "🗂️ 稿件管理" 按钮查看所有投稿
   - 分页显示投稿列表
   - 选择删除不合适的投稿
   - 可以添加拒稿说明
   
4. **拒稿通知**: 被删除的投稿会自动通知作者
   - 私聊发送拒稿通知
   - 包含作品信息和删除原因
   - 记录删除操作日志

### 其他功能模块
- 提案系统
- 审核系统  
- 法庭系统
- 自助管理系统
- (新) 自助身份组申请系统

## 安装和配置

1. 克隆仓库
2. 安装依赖: `npm install`
3. 复制环境变量模板：`cp .env.sample .env`（Windows 可手动复制）
4. 配置环境变量，具体需要配置的环境变量为：
```
DISCORD_TOKEN=<从 Bot 栏获得的 Token>
CLIENT_ID=<从 General Information 栏获得的 Application ID>
GUILD_IDS=<必填，命令注册目标服务器ID列表，逗号分隔，例如 123...,456...>
```
5. 启动机器人: `npm start`

> 当前采用严格模式：必须配置 `GUILD_IDS`，否则启动会失败。

## 使用说明

### 赛事系统设置流程
1. 使用 `/设置赛事申请入口` 设置基础配置
2. 使用 `/设置赛事审核员` 设置审核权限
3. 使用 `/管理许可论坛` 管理投稿论坛（可选）
4. 用户可以开始申请举办赛事

### 投稿管理流程
1. 主办人在赛事频道点击 "🗂️ 稿件管理"
2. 查看所有投稿作品列表
3. 选择要删除的投稿
4. 选择是否添加拒稿说明
5. 系统自动通知被拒稿的用户

### (新) 自助身份组申请系统设置流程
1.  **(管理员)** 在一个**仅管理员可见**的频道中，使用 `/创建管理面板` 命令，生成一个集成了“添加”、“移除”、“列表”功能的交互式管理面板。
2.  **(管理员)** 使用管理面板的“添加”功能，为服务器配置一个或多个可供申请的身份组及其复杂的申请条件（如前置身份组、频道活跃度、社区投票等）。
3.  **(管理员)** 在一个**所有用户可见**的频道中，使用 `/创建自助身份组面板` 命令，为用户创建一个永久性的申请入口。
4.  **(管理员, 可选)** 如果配置了活跃度要求，使用 `/回溯统计活跃度` 命令来扫描历史消息，初始化用户数据。
5.  **(用户)** 点击用户申请入口的按钮，从弹出的下拉菜单中选择身份组进行申请。
6.  **(用户, 可选)** 使用 `/查询我的活跃度` 命令查看自己在被统计频道的数据。

## 指令列表

### (新) 自助身份组申请系统相关指令
- `/创建管理面板` - (管理员) 创建一个集“增/删/改/查”功能于一体的管理面板。
- `/创建自助身份组面板` - (管理员) 创建面向用户的申请入口面板。
- `/回溯统计活跃度` - 扫描历史消息以统计活跃度。
- `/查询我的活跃度` - 查询自己的活跃度数据。
- `/debug-roles` - (调试功能) 显示服务器所有身份组的详细信息。
- 注：自助申请模块的架构具有向前兼容性，用于支持以后可能更复杂的自助身份组申请逻辑（虽然以后有新验证逻辑还是需要改代码）

### 提案功能相关指令

- /setupForm 设置提案表单提交入口
- /deleteEntry 删除提案表单提交入口
- /withdrawProposal 撤回提案
- /setCheckChannel 设置检查信息回传频道

### 自动审核功能相关指令

- /setupReview 设置审核提交入口
- /deleteReviewEntry 删除审核提交入口
- /addAllowPreviewServer 添加允许的审核帖子服务器来源
- /removeAllowPreviewServer 移除允许的审核帖子服务器来源
- /addAllowedForum 添加允许的审核帖子论坛频道来源
- /removeAllowedForum 移除允许的审核帖子论坛频道来源
