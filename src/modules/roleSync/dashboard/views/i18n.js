const TRANSLATIONS = {
    zh: {
        // Nav
        nav_brand: '身份组同步面板',
        nav_overview: '概览',
        nav_members: '成员',
        nav_jobs: '同步任务',
        nav_logs: '变更日志',
        nav_config: '配置',
        nav_logout: '退出',
        lang_toggle: 'English',

        // Common
        btn_filter: '筛选',
        btn_clear: '清除',
        total_records: '共 {0} 条记录',
        pagination_prev: '&laquo; 上一页',
        pagination_next: '下一页 &raquo;',
        export_csv: '导出 CSV',
        filter_all: '全部',
        col_actions: '操作',

        // Status
        status_pending: '等待中',
        status_processing: '处理中',
        status_completed: '已完成',
        status_failed: '失败',
        status_cancelled: '已取消',
        status_success: '成功',
        status_skipped: '已跳过',
        status_noop: '无操作',
        status_planned: '已计划',

        // Overview
        overview_title: '概览',
        guilds_section: '服务器',
        intersections_section: '交集成员（符合同步条件）',
        job_queue_section: '任务队列',
        active_lanes_section: '活跃通道',
        stat_active: '活跃',
        stat_total: '总计',
        stat_inactive: '不活跃',
        stat_in_both_guilds: '同时在两个服务器中',
        col_lane: '通道',
        col_status: '状态',
        col_count: '数量',

        // Members
        members_title: '成员列表',
        filter_guild: '服务器',
        filter_status: '状态',
        filter_active: '活跃',
        filter_inactive: '不活跃',
        filter_left: '已离开',
        filter_user_id: '用户 ID',
        search_placeholder: '搜索用户 ID...',
        col_guild: '服务器',
        col_user: '用户',
        col_user_id: '用户 ID',
        col_active: '状态',
        col_joined_at: '加入时间',
        col_left_at: '离开时间',
        col_updated_at: '更新时间',
        col_sync_stats: '同步统计',
        badge_active: '活跃',
        badge_inactive: '不活跃',
        badge_left: '已离开',
        btn_details: '详情',
        btn_expand: '展开详情',
        sync_ok: '成功',
        sync_fail: '失败',
        sync_last: '最近',

        // Member detail
        member_detail_title: '成员详情',
        discord_username: 'Discord 用户名',
        guild_presence_section: '服务器状态',
        sync_history_section: '同步历史',
        back_to_members: '返回成员列表',
        no_sync_history: '暂无同步记录',
        inline_role_mappings: '关联角色映射',
        member_roles_section: '成员身份组',
        roles_count_label: '个身份组',
        synced_roles_label: '个参与同步',
        roles_unavailable: '无法获取身份组信息（API 不可用或成员已离开）',
        roles_fetch_failed: '获取失败',
        no_roles: '无身份组',
        roles_no_active_guild: '该成员不在任何活跃服务器中',
        btn_refresh_roles: '刷新身份组',
        btn_view_all_history: '查看全部 {0} 条记录',

        // Jobs
        jobs_title: '同步任务',
        filter_lane: '通道',
        filter_link: '同步链接',
        col_id: 'ID',
        col_action: '动作',
        col_source_role: '源身份组',
        col_target_role: '目标身份组',
        col_attempts: '尝试次数',
        col_created: '创建时间',
        col_error: '错误',

        // Logs
        logs_title: '变更日志',
        filter_result: '结果',
        filter_action: '动作',
        filter_from: '开始时间',
        filter_to: '结束时间',
        col_event: '事件',
        col_time: '时间',
        col_result: '结果',

        // Config
        config_title: '配置',
        sync_links_section: '同步链接',
        role_mappings_section: '身份组映射',
        col_link_id: '链接 ID',
        col_source_guild: '源服务器',
        col_target_guild: '目标服务器',
        col_enabled: '启用',
        col_conflict_policy: '冲突策略',
        col_sync_mode: '同步模式',
        col_max_delay: '最大延迟(秒)',
        col_type: '类型',
        col_copy_visual: '复制外观',
        col_copy_perms: '复制权限',
        col_note: '备注',
        lbl_enabled: '已启用',
        lbl_disabled: '已禁用',
        lbl_yes: '是',
        lbl_no: '否',
        btn_enable: '启用',
        btn_disable: '禁用',
        btn_edit: '编辑',
        btn_delete: '删除',
        btn_add_mapping: '新增映射',
        btn_save: '保存',
        btn_cancel: '取消',
        confirm_delete: '确定要删除这条映射吗？',
        form_add_title: '新增身份组映射',
        form_edit_title: '编辑身份组映射',
        validation_error: '表单验证失败',
    },
    en: {
        // Nav
        nav_brand: 'RoleSync Dashboard',
        nav_overview: 'Overview',
        nav_members: 'Members',
        nav_jobs: 'Jobs',
        nav_logs: 'Logs',
        nav_config: 'Config',
        nav_logout: 'Logout',
        lang_toggle: '中文',

        // Common
        btn_filter: 'Filter',
        btn_clear: 'Clear',
        total_records: 'Total: {0} records',
        pagination_prev: '&laquo; Prev',
        pagination_next: 'Next &raquo;',
        export_csv: 'Export CSV',
        filter_all: 'All',
        col_actions: 'Actions',

        // Status
        status_pending: 'pending',
        status_processing: 'processing',
        status_completed: 'completed',
        status_failed: 'failed',
        status_cancelled: 'cancelled',
        status_success: 'success',
        status_skipped: 'skipped',
        status_noop: 'noop',
        status_planned: 'planned',

        // Overview
        overview_title: 'Overview',
        guilds_section: 'Guilds',
        intersections_section: 'Intersections (eligible members)',
        job_queue_section: 'Job Queue',
        active_lanes_section: 'Active Lanes',
        stat_active: 'active',
        stat_total: 'total',
        stat_inactive: 'inactive',
        stat_in_both_guilds: 'members in both guilds',
        col_lane: 'Lane',
        col_status: 'Status',
        col_count: 'Count',

        // Members
        members_title: 'Members',
        filter_guild: 'Guild',
        filter_status: 'Status',
        filter_active: 'Active',
        filter_inactive: 'Inactive',
        filter_left: 'Left',
        filter_user_id: 'User ID',
        search_placeholder: 'Search user ID...',
        col_guild: 'Guild',
        col_user: 'User',
        col_user_id: 'User ID',
        col_active: 'Status',
        col_joined_at: 'Joined At',
        col_left_at: 'Left At',
        col_updated_at: 'Updated At',
        col_sync_stats: 'Sync Stats',
        badge_active: 'Active',
        badge_inactive: 'Inactive',
        badge_left: 'Left',
        btn_details: 'Details',
        btn_expand: 'Expand Details',
        sync_ok: 'ok',
        sync_fail: 'fail',
        sync_last: 'last',

        // Member detail
        member_detail_title: 'Member Details',
        discord_username: 'Discord Username',
        guild_presence_section: 'Guild Presence',
        sync_history_section: 'Sync History',
        back_to_members: 'Back to Members',
        no_sync_history: 'No sync history found',
        inline_role_mappings: 'Related Role Mappings',
        member_roles_section: 'Member Roles',
        roles_count_label: 'roles',
        synced_roles_label: 'synced',
        roles_unavailable: 'Unable to fetch role info (API unavailable or member has left)',
        roles_fetch_failed: 'Fetch failed',
        no_roles: 'No roles',
        roles_no_active_guild: 'Member is not in any active guild',
        btn_refresh_roles: 'Refresh Roles',
        btn_view_all_history: 'View all {0} records',

        // Jobs
        jobs_title: 'Sync Jobs',
        filter_lane: 'Lane',
        filter_link: 'Link',
        col_id: 'ID',
        col_action: 'Action',
        col_source_role: 'Source Role',
        col_target_role: 'Target Role',
        col_attempts: 'Attempts',
        col_created: 'Created',
        col_error: 'Error',

        // Logs
        logs_title: 'Change Logs',
        filter_result: 'Result',
        filter_action: 'Action',
        filter_from: 'From',
        filter_to: 'To',
        col_event: 'Event',
        col_time: 'Time',
        col_result: 'Result',

        // Config
        config_title: 'Configuration',
        sync_links_section: 'Sync Links',
        role_mappings_section: 'Role Mappings',
        col_link_id: 'Link ID',
        col_source_guild: 'Source Guild',
        col_target_guild: 'Target Guild',
        col_enabled: 'Enabled',
        col_conflict_policy: 'Conflict Policy',
        col_sync_mode: 'Sync Mode',
        col_max_delay: 'Max Delay (s)',
        col_type: 'Type',
        col_copy_visual: 'Copy Visual',
        col_copy_perms: 'Copy Perms',
        col_note: 'Note',
        lbl_enabled: 'Enabled',
        lbl_disabled: 'Disabled',
        lbl_yes: 'Yes',
        lbl_no: 'No',
        btn_enable: 'Enable',
        btn_disable: 'Disable',
        btn_edit: 'Edit',
        btn_delete: 'Delete',
        btn_add_mapping: 'Add Mapping',
        btn_save: 'Save',
        btn_cancel: 'Cancel',
        confirm_delete: 'Are you sure you want to delete this mapping?',
        form_add_title: 'Add Role Mapping',
        form_edit_title: 'Edit Role Mapping',
        validation_error: 'Validation Error',
    },
};

function getLang(req) {
    const lang = req.query.lang;
    return lang === 'en' ? 'en' : 'zh';
}

function t(lang, key, ...args) {
    const value = (TRANSLATIONS[lang] && TRANSLATIONS[lang][key]) ?? key;
    if (args.length === 0) return value;
    return value.replace(/\{(\d+)\}/g, (_, i) => args[i] ?? '');
}

module.exports = { t, getLang, TRANSLATIONS };
