# 投票系统模块

## 功能概述

这个模块为Discord机器人提供完整的投票功能，支持：

- 创建自定义投票
- 设置投票选项和权限
- 匿名/实名投票
- 实时/结束后显示结果
- 自动结束投票并公布结果

## 使用方法

### 管理员创建投票

1. 使用 `/开启投票` 命令
2. 点击"📊 设置投票"按钮
3. 填写投票信息：
   - **投票主题**: 投票的标题
   - **投票选项**: 用逗号分隔的选项（如：选项1,选项2,选项3）
   - **身份组权限**: 允许投票的身份组（留空表示所有人可投票）
   - **结束时间**: 投票持续时间，支持多种格式：
     - `60` - 60分钟
     - `6d4h27m` - 6天4小时27分钟
     - `72h` - 72小时
     - `30min` - 30分钟
     - `1d` - 1天
     - `2h30m` - 2小时30分钟
   - **投票设置**: 匿名:是/否,实时显示:是/否

### 用户投票

1. 在投票消息中点击对应的选项按钮
2. 可以更改投票（点击新选项）
3. 再次点击同一选项可取消投票

## 时间格式说明

投票结束时间支持以下格式：

### 基本格式
- `d` 或 `day/days` - 天数
- `h` 或 `hour/hours` - 小时数  
- `m` 或 `min/minute/minutes` - 分钟数

### 示例
- `6d4h27m` - 6天4小时27分钟后结束
- `72h` - 72小时后结束
- `30min` - 30分钟后结束
- `1d` - 1天后结束
- `2h30m` - 2小时30分钟后结束
- `5days2hours` - 5天2小时后结束
- `60` - 60分钟后结束（兼容旧格式）

### 注意事项
- 时间格式不区分大小写
- 可以组合使用多个时间单位
- 最长不能超过7天
- 支持空格分隔（如：`6d 4h 27m`）

## 文件结构

```
src/modules/voting/
├── commands/
│   └── createVote.js          # /开启投票 命令
├── components/
│   ├── voteSetupModal.js      # 投票设置表格
│   ├── votePanel.js           # 投票面板组件
│   └── voteButtons.js         # 投票按钮组件
├── services/
│   ├── voteManager.js         # 投票管理服务
│   └── voteChecker.js         # 投票状态检查器
├── utils/
│   └── voteUtils.js           # 投票工具函数
└── data/
    └── votes.json             # 投票数据存储
```

## 权限要求

- 创建投票：需要 `ManageMessages` 权限
- 参与投票：根据投票设置的身份组权限

## 数据存储

投票数据存储在 `data/votes.json` 文件中，包含：
- 投票ID、标题、选项
- 权限设置、结束时间
- 投票记录和结果
- 匿名和显示设置 